{
  "data":
  {
    "repository":
    {
      "issue":
      {
        "number": 420,
        "title": "[BUG]: PyCall.jlwrap error-- dimensional constraint",
        "body": "### What happened?\n\nHi Miles,\r\nI am trying out the new feature where we can impose the dimensional constraint. I just copied the example available from the collection of toy examples (number ten), and I run to the following error:\n\n### Version\n\n0.16.3\n\n### Operating System\n\nLinux\n\n### Package Manager\n\nConda\n\n### Interface\n\nJupyter Notebook\n\n### Relevant log output\n\n```shell\nRuntimeError                              Traceback (most recent call last)\r\nCell In[5], line 1\r\n----> 1 model.fit(\r\n      2     X,\r\n      3     y,\r\n      4     X_units=[\"Constants.M_sun\", \"kg\", \"Constants.R_earth\"],\r\n      5     y_units=\"kg * m / s^2\"\r\n      6 )\r\n\r\nFile /glade/user/opt/miniconda/envs/eq_new/lib/python3.11/site-packages/pysr/sr.py:1970, in PySRRegressor.fit(self, X, y, Xresampled, weights, variable_names, X_units, y_units)\r\n   1967     self._checkpoint()\r\n   1969 # Perform the search:\r\n-> 1970 self._run(X, y, mutated_params, weights=weights, seed=seed)\r\n   1972 # Then, after fit, we save again, so the pickle file contains\r\n   1973 # the equations:\r\n   1974 if not self.temp_equation_file:\r\n\r\nFile /glade/user/opt/miniconda/envs/eq_new/lib/python3.11/site-packages/pysr/sr.py:1800, in PySRRegressor._run(self, X, y, mutated_params, weights, seed)\r\n   1796     y_variable_names = [f\"y{_subscriptify(i)}\" for i in range(y.shape[1])]\r\n   1798 # Call to Julia backend.\r\n   1799 # See https://github.com/MilesCranmer/SymbolicRegression.jl/blob/master/src/SymbolicRegression.jl\r\n-> 1800 self.raw_julia_state_ = SymbolicRegression.equation_search(\r\n   1801     Main.X,\r\n   1802     Main.y,\r\n   1803     weights=Main.weights,\r\n   1804     niterations=int(self.niterations),\r\n   1805     variable_names=self.feature_names_in_.tolist(),\r\n   1806     display_variable_names=self.display_feature_names_in_.tolist(),\r\n   1807     y_variable_names=y_variable_names,\r\n   1808     X_units=self.X_units_,\r\n   1809     y_units=self.y_units_,\r\n   1810     options=options,\r\n   1811     numprocs=cprocs,\r\n   1812     parallelism=parallelism,\r\n   1813     saved_state=self.raw_julia_state_,\r\n   1814     return_state=True,\r\n   1815     addprocs_function=cluster_manager,\r\n   1816     progress=progress and self.verbosity > 0 and len(y.shape) == 1,\r\n   1817     verbosity=int(self.verbosity),\r\n   1818 )\r\n   1820 # Set attributes\r\n   1821 self.equations_ = self.get_hof()\r\n\r\nRuntimeError: <PyCall.jlwrap (in a Julia function called from Python)\r\nJULIA: MethodError: no method matching _method_instances(::Type{typeof(*)}, ::Type{Tuple{SymbolicRegression.DimensionalAnalysisModule.WildcardQuantity{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, SymbolicRegression.DimensionalAnalysisModule.WildcardQuantity{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}}})\r\nThe applicable method may be too new: running in world age 45056, while current world is 54697.\r\n\r\nClosest candidates are:\r\n  _method_instances(::Any, ::Any) (method too new to be called from this world context.)\r\n   @ Tricks /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/Tricks/7oAyo/src/Tricks.jl:150\r\n\r\nStacktrace:\r\n  [1] #s1778#1\r\n    @ /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/Tricks/7oAyo/src/Tricks.jl:16 [inlined]\r\n  [2] var\"#s1778#1\"(T::Any, ::Any, f::Any, t::Any)\r\n    @ Tricks ./none:0\r\n  [3] (::Core.GeneratedFunctionStub)(::Any, ::Vararg{Any})\r\n    @ Core ./boot.jl:602\r\n  [4] deg2_eval(op::typeof(*), l::SymbolicRegression.DimensionalAnalysisModule.WildcardQuantity{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, r::SymbolicRegression.DimensionalAnalysisModule.WildcardQuantity{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}})\r\n    @ SymbolicRegression.DimensionalAnalysisModule /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/DimensionalAnalysis.jl:142\r\n  [5] violates_dimensional_constraints_dispatch(tree::Node{Float32}, x_units::Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, x::SubArray{Float32, 1, Matrix{Float32}, Tuple{Base.Slice{Base.OneTo{Int64}}, Int64}, true}, operators::DynamicExpressions.OperatorEnumModule.OperatorEnum)\r\n    @ SymbolicRegression.DimensionalAnalysisModule /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/DimensionalAnalysis.jl:166\r\n  [6] violates_dimensional_constraints_dispatch(tree::Node{Float32}, x_units::Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, x::SubArray{Float32, 1, Matrix{Float32}, Tuple{Base.Slice{Base.OneTo{Int64}}, Int64}, true}, operators::DynamicExpressions.OperatorEnumModule.OperatorEnum)\r\n    @ SymbolicRegression.DimensionalAnalysisModule /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/DimensionalAnalysis.jl:164\r\n  [7] violates_dimensional_constraints_dispatch(tree::Node{Float32}, x_units::Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, x::SubArray{Float32, 1, Matrix{Float32}, Tuple{Base.Slice{Base.OneTo{Int64}}, Int64}, true}, operators::DynamicExpressions.OperatorEnumModule.OperatorEnum)\r\n    @ SymbolicRegression.DimensionalAnalysisModule /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/DimensionalAnalysis.jl:161\r\n  [8] violates_dimensional_constraints\r\n    @ /glade/useropt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/DimensionalAnalysis.jl:191 [inlined]\r\n  [9] violates_dimensional_constraints\r\n    @ /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/DimensionalAnalysis.jl:177 [inlined]\r\n [10] dimensional_regularization\r\n    @ /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/LossFunctions.jl:215 [inlined]\r\n [11] _eval_loss(tree::Node{Float32}, dataset::Dataset{Float32, Float32, Matrix{Float32}, Vector{Float32}, Nothing, NamedTuple{(), Tuple{}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, options::Options{Int64, DynamicExpressions.OperatorEnumModule.OperatorEnum, false, Optim.Options{Float64, Nothing}, StatsBase.Weights{Float64, Float64, Vector{Float64}}}, regularization::Bool, idx::Nothing)\r\n    @ SymbolicRegression.LossFunctionsModule /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/LossFunctions.jl:67\r\n [12] eval_loss(tree::Node{Float32}, dataset::Dataset{Float32, Float32, Matrix{Float32}, Vector{Float32}, Nothing, NamedTuple{(), Tuple{}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, options::Options{Int64, DynamicExpressions.OperatorEnumModule.OperatorEnum, false, Optim.Options{Float64, Nothing}, StatsBase.Weights{Float64, Float64, Vector{Float64}}}; regularization::Bool, idx::Nothing)\r\n    @ SymbolicRegression.LossFunctionsModule /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/LossFunctions.jl:101\r\n [13] eval_loss\r\n    @ /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/LossFunctions.jl:93 [inlined]\r\n [14] #score_func#5\r\n    @ /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/LossFunctions.jl:160 [inlined]\r\n [15] score_func\r\n    @ /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/LossFunctions.jl:157 [inlined]\r\n [16] PopMember(dataset::Dataset{Float32, Float32, Matrix{Float32}, Vector{Float32}, Nothing, NamedTuple{(), Tuple{}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, t::Node{Float32}, options::Options{Int64, DynamicExpressions.OperatorEnumModule.OperatorEnum, false, Optim.Options{Float64, Nothing}, StatsBase.Weights{Float64, Float64, Vector{Float64}}}, complexity::Nothing; ref::Int64, parent::Int64, deterministic::Bool)\r\n    @ SymbolicRegression.PopMemberModule /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/PopMember.jl:99\r\n [17] PopMember (repeats 2 times)\r\n    @ /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/PopMember.jl:88 [inlined]\r\n [18] #2\r\n    @ ./none:0 [inlined]\r\n [19] iterate\r\n    @ ./generator.jl:47 [inlined]\r\n [20] collect(itr::Base.Generator{UnitRange{Int64}, SymbolicRegression.PopulationModule.var\"#2#3\"{Float32, Int64, Options{Int64, DynamicExpressions.OperatorEnumModule.OperatorEnum, false, Optim.Options{Float64, Nothing}, StatsBase.Weights{Float64, Float64, Vector{Float64}}}, Int64, Dataset{Float32, Float32, Matrix{Float32}, Vector{Float32}, Nothing, NamedTuple{(), Tuple{}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}}})\r\n    @ Base ./array.jl:782\r\n [21] #Population#1\r\n    @ /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/Population.jl:51 [inlined]\r\n [22] Population\r\n    @ /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/Population.jl:37 [inlined]\r\n [23] #6\r\n    @ ./none:0 [inlined]\r\n [24] iterate\r\n    @ ./generator.jl:47 [inlined]\r\n [25] collect(itr::Base.Generator{UnitRange{Int64}, SymbolicRegression.SearchUtilsModule.var\"#6#8\"{Dataset{Float32, Float32, Matrix{Float32}, Vector{Float32}, Nothing, NamedTuple{(), Tuple{}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, Options{Int64, DynamicExpressions.OperatorEnumModule.OperatorEnum, false, Optim.Options{Float64, Nothing}, StatsBase.Weights{Float64, Float64, Vector{Float64}}}}})\r\n    @ Base ./array.jl:782\r\n [26] #5\r\n    @ ./none:0 [inlined]\r\n [27] iterate\r\n    @ ./generator.jl:47 [inlined]\r\n [28] collect(itr::Base.Generator{Vector{Dataset{Float32, Float32, Matrix{Float32}, Vector{Float32}, Nothing, NamedTuple{(), Tuple{}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}}, SymbolicRegression.SearchUtilsModule.var\"#5#7\"{Int64, Options{Int64, DynamicExpressions.OperatorEnumModule.OperatorEnum, false, Optim.Options{Float64, Nothing}, StatsBase.Weights{Float64, Float64, Vector{Float64}}}}})\r\n    @ Base ./array.jl:782\r\n [29] init_dummy_pops\r\n    @ /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/SearchUtils.jl:51 [inlined]\r\n [30] _equation_search(#unused#::Val{:multithreading}, #unused#::Val{1}, datasets::Vector{Dataset{Float32, Float32, Matrix{Float32}, Vector{Float32}, Nothing, NamedTuple{(), Tuple{}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}}, niterations::Int64, options::Options{Int64, DynamicExpressions.OperatorEnumModule.OperatorEnum, false, Optim.Options{Float64, Nothing}, StatsBase.Weights{Float64, Float64, Vector{Float64}}}, numprocs::Nothing, procs::Nothing, addprocs_function::Nothing, runtests::Bool, saved_state::Nothing, verbosity::Int64, progress::Bool, #unused#::Val{true})\r\n    @ SymbolicRegression /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/SymbolicRegression.jl:601\r\n [31] equation_search(datasets::Vector{Dataset{Float32, Float32, Matrix{Float32}, Vector{Float32}, Nothing, NamedTuple{(), Tuple{}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.Dimensions{DynamicQuantities.FixedRational{Int32, 25200}}}, Vector{DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}, DynamicQuantities.Quantity{Float32, DynamicQuantities.SymbolicDimensions{DynamicQuantities.FixedRational{Int32, 25200}}}}}; niterations::Int64, options::Options{Int64, DynamicExpressions.OperatorEnumModule.OperatorEnum, false, Optim.Options{Float64, Nothing}, StatsBase.Weights{Float64, Float64, Vector{Float64}}}, parallelism::String, numprocs::Nothing, procs::Nothing, addprocs_function::Nothing, runtests::Bool, saved_state::Nothing, return_state::Bool, verbosity::Int64, progress::Bool, v_dim_out::Val{1})\r\n    @ SymbolicRegression /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/SymbolicRegression.jl:507\r\n [32] equation_search(X::Matrix{Float32}, y::Matrix{Float32}; niterations::Int64, weights::Nothing, options::Options{Int64, DynamicExpressions.OperatorEnumModule.OperatorEnum, false, Optim.Options{Float64, Nothing}, StatsBase.Weights{Float64, Float64, Vector{Float64}}}, variable_names::Vector{String}, display_variable_names::Vector{String}, y_variable_names::Nothing, parallelism::String, numprocs::Nothing, procs::Nothing, addprocs_function::Nothing, runtests::Bool, saved_state::Nothing, return_state::Bool, loss_type::Type{Nothing}, verbosity::Int64, progress::Bool, X_units::Vector{String}, y_units::String, v_dim_out::Val{1}, multithreaded::Nothing, varMap::Nothing)\r\n    @ SymbolicRegression /glade/user/opt/miniconda/envs/eq_new/share/pysr/depot/packages/SymbolicRegression/XKtla/src/SymbolicRegression.jl:385\n```\n\n\n### Extra Info\n\nThe installed packages are: \r\nJulia 1.9.3\r\nPysr 0.16.3  \r\npython 3.11.5\r\n\r\nWhen I remove the dimensional constraints the code runs with no issue. \r\n\r\nI very much appreciate any advice",
        "comments":
        {
          "nodes":
          [
            {
              "author":
              {
                "login": "MilesCranmer"
              },
              "body": "Hi @Sshamekh,\r\n\r\nThanks for the bug report. This will be a bit lengthy to fix but I’ll get on it asap. In the meantime you can fix this issue by upgrading to Juli 1.10 (it’s currently in beta, but it will fix things).\r\n\r\nCheers,\r\nMiles",
              "createdAt": "2023-09-02T22:31:08Z"
            },
            {
              "author":
              {
                "login": "drcassar"
              },
              "body": "Can confirm, updating to Julia 1.10 fixed it for me.",
              "createdAt": "2023-10-18T17:42:44Z"
            },
            {
              "author":
              {
                "login": "zhuyi-bjut"
              },
              "body": "@MilesCranmer Hi Miles, I have the same error now. I have tried Julia1.10.3 and Julia1.10.0, but the kernel seems to have crashed ( my previous use of Julia1.9 can run normally ). So I wonder if you can tell the python and julia versions that are currently running correctly and can achieve dimensional balance ? Thank you",
              "createdAt": "2024-06-02T04:49:06Z"
            },
            {
              "author":
              {
                "login": "MilesCranmer"
              },
              "body": "@zhuyi-bjut could you please file a new issue for your bug? https://github.com/MilesCranmer/PySR/issues/new/choose",
              "createdAt": "2024-06-02T12:30:23Z"
            }
          ],
          "pageInfo":
          {
            "hasNextPage": false,
            "endCursor": "Y3Vyc29yOnYyOpHOf8g96w=="
          }
        }
      }
    }
  }
}